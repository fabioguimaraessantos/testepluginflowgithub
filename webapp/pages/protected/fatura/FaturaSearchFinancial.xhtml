<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:sec="http://www.springframework.org/security/facelets/tags"
      xmlns:a4j="http://richfaces.org/a4j">

<ui:composition template="/WEB-INF/templates/formLayout.xhtml">
    <ui:define name="titleForm">
        <h:panelGroup>
            <a4j:region
                    rendered="#{faturaController.bean.financialMode == null or !faturaController.bean.financialMode}">
                #{bundle['_nls.menu.fatura']} &gt; #{bundle['_nls.menu.fatura.research']}
            </a4j:region>
            <a4j:region rendered="#{faturaController.bean.financialMode}">
                #{bundle['_nls.menu.fatura.faturamento']}
            </a4j:region>
        </h:panelGroup>
    </ui:define>


    <ui:define name="bodyForm">
        <rich:spacer height="0" width="560" styleClass="noMargin" />
        <h:form styleClass="noMargin">
            <a4j:keepAlive beanName="faturaBean" />
            <a4j:loadScript src="/js/utils.js" />
            <a4j:loadScript src="/js/jquery.numeric.js" />

            <rich:panel style="padding:0" headerClass="outpanelHeader">

                <h:panelGrid columns="6">
                    <h:outputText
                            value="#{bundle['_nls.fatura.data_previsao.label']}*:"
                            for="dataPrevisaoBeg" styleClass="labelGeneric" />

                    <rich:spacer width="30" />
                    <a4j:outputPanel id="dataPrevisaoBeg" layout="block">
                        <rich:calendar value="#{faturaController.bean.dataPrevisaoBeg}"
                                       locale="#{bundle['_nls.calendar.locale']}" required="true"
                                       datePattern="#{bundle['_nls.date.pattern']}"
                                       enableManualInput="true" showApplyButton="false" cellWidth="24px"
                                       cellHeight="22px" style="width:200px"
                                       label="#{bundle['_nls.fatura.data_previsao_inicio.label']}"
                                       tabindex="1" />
                    </a4j:outputPanel>

                    <h:outputLabel
                            value="#{bundle['_nls.fatura.data_previsao.until.label']}*:"
                            styleClass="labelGeneric" />

                    <a4j:outputPanel id="dataPrevisaoEnd" layout="block">
                        <rich:calendar value="#{faturaController.bean.dataPrevisaoEnd}"
                                       locale="#{bundle['_nls.calendar.locale']}" required="true"
                                       datePattern="#{bundle['_nls.date.pattern']}"
                                       enableManualInput="true" showApplyButton="false" cellWidth="24px"
                                       cellHeight="22px" style="width:200px"
                                       label="#{bundle['_nls.fatura.data_previsao_fim.label']}"
                                       tabindex="2" />
                    </a4j:outputPanel>

                    <h:outputText
                            value="#{bundle['_nls.date.pattern.name']}: #{bundle['_nls.date.pattern']}"
                            styleClass="labelDatePattern" />
                </h:panelGrid>

            </rich:panel>

            <h:panelGrid columns="3">

                <h:panelGrid columns="2">
                    <h:outputText value="#{bundle['_nls.fatura.codigo.label']}:"
                                  for="loginAe" styleClass="labelGeneric" />
                    <h:inputText validator="#{xssValidator.validate}"
                                 value="#{faturaController.bean.filter.codigoFatura}"
                                 label="#{bundle['_nls.fatura.codigo.label']}"
                                 style=" width : 80px;" tabindex="6" id="codigoFatura">
                        <rich:jQuery selector="#codigoFatura" timing="onload"
                                     query="numeric('#{bundle['locale.decimal.separator']}')" />
                    </h:inputText>

                    <h:outputText value="#{bundle['_nls.fatura.cliente.label']}:"
                                  for="cliente" styleClass="labelGeneric" />
                    <a4j:region>
                        <rich:comboBox id="cliente"
                                       label="#{bundle['_nls.fatura.cliente.label']}"
                                       value="#{faturaController.bean.clienteFilter.nomeCliente}"
                                       suggestionValues="#{faturaController.bean.clienteList}"
                                       directInputSuggestions="true"
                                       validator="#{faturaController.validateCliente}"
                                       valueChangeListener="#{faturaController.prepareMsaCombo}"
                                       tabindex="3">
                            <f:validator validatorId="xssValidator" />
                            <a4j:support event="onselect" reRender="msaCombo"
                                         limitToList="true" />
                            <a4j:support event="onchange" reRender="msaCombo"
                                         limitToList="true" />
                        </rich:comboBox>
                    </a4j:region>

                    <h:outputText value="#{bundle['_nls.fatura.login_ae.label']}:"
                                  for="loginAe" styleClass="labelGeneric" />
                    <h:inputText validator="#{xssValidator.validate}"
                                 value="#{faturaController.bean.filter.codigoLoginAe}"
                                 style=" width : 149px;" tabindex="6" />

                </h:panelGrid>

                <h:panelGrid columns="2">
                    <rich:spacer height="15" />
                    <rich:spacer />
                    <h:outputText value="#{bundle['_nls.fatura.msa.label']}:"
                                  for="msaCombo" styleClass="labelGeneric" />
                    <a4j:region>
                        <rich:comboBox id="msaCombo"
                                       label="#{bundle['_nls.fatura.msa.label']}"
                                       value="#{faturaController.bean.msaFilter.nomeMsa}"
                                       suggestionValues="#{faturaController.bean.msaList}"
                                       directInputSuggestions="true"
                                       validator="#{faturaController.validateMsa}"
                                       valueChangeListener="#{faturaController.prepareDealFiscalCombo}"
                                       tabindex="4">
                            <f:validator validatorId="xssValidator"/>
                            <a4j:support event="onselect" reRender="dealFiscalCombo"
                                         limitToList="true" />
                            <a4j:support event="onchange" reRender="dealFiscalCombo"
                                         limitToList="true" />
                        </rich:comboBox>
                    </a4j:region>

                    <h:outputText value="#{bundle['_nls.fatura.moeda.label']}:"
                                  for="moeda" styleClass="labelGeneric" />
                    <rich:comboBox id="moeda"
                                   label="#{bundle['_nls.fatura.moeda.label']}"
                                   value="#{faturaController.bean.filter.moeda.nomeMoeda}"
                                   suggestionValues="#{faturaController.bean.moedaList}"
                                   directInputSuggestions="true"
                                   validator="#{faturaController.validateMoeda}" tabindex="7">
                        <f:validator validatorId="xssValidator"/>
                    </rich:comboBox>

                </h:panelGrid>

                <h:panelGrid columns="2">
                    <rich:spacer height="15" />
                    <rich:spacer />
                    <h:outputText value="#{bundle['_nls.fatura.deal_fiscal.label']}:"
                                  for="dealFiscalCombo" styleClass="labelGeneric" />
                    <rich:comboBox id="dealFiscalCombo"
                                   label="#{bundle['_nls.fatura.deal_fiscal.label']}"
                                   value="#{faturaController.bean.filter.dealFiscal.nomeDealFiscal}"
                                   suggestionValues="#{faturaController.bean.dealFiscalList}"
                                   directInputSuggestions="true"
                                   validator="#{faturaController.validateDealFiscal}" tabindex="5">
                        <f:validator validatorId="xssValidator"/>
                    </rich:comboBox>

                    <h:outputText
                            value="#{bundle['_nls.fatura.indicador_status.label']}:"
                            for="indicadorStatus" styleClass="labelGeneric" />
                    <rich:comboBox validator="#{xssValidator.validate}"
                                   id="indicadorStatus" enableManualInput="false"
                                   label="#{bundle['_nls.fatura.indicador_status.label']}"
                                   value="#{faturaController.bean.filter.indicadorStatus}"
                                   directInputSuggestions="true" converter="StatusFaturaConverter"
                                   tabindex="8">
                        <f:selectItem itemValue="ALL" />
                        <f:selectItem itemValue="OP" />
                        <f:selectItem itemValue="AP" />
                        <f:selectItem itemValue="SB" />
                        <f:selectItem itemValue="IN" />
                        <f:selectItem itemValue="ER" />
                        <f:selectItem itemValue="PD" />
                        <f:selectItem itemValue="PR" />
                    </rich:comboBox>

                </h:panelGrid>

                <h:panelGrid columns="2">
                    <h:outputText value="#{bundle['_nls.fatura.search_deleted_invoices.label']}" styleClass="labelGeneric" />
                    <h:selectBooleanCheckbox styleClass="noMargin"
                                             value="#{faturaController.bean.searchDeletedInvoice}" />
                </h:panelGrid>

                <f:facet name="footer">
                    <h:panelGrid columns="3" cellpadding="0" cellspacing="0">
                        <a4j:commandButton value="#{bundle['_nls.button.search']}"
                                           styleClass="buttonGeneric" type="submit"
                                           reRender="faturaTable,errorMsgId,faturaPanel"
                                           action="#{faturaController.findByFilter}" tabindex="9" />
                        <rich:spacer width="5" styleClass="noMargin" />
                        <sec:ifAnyGranted roles="BOF.INVOICING:ED">
                            <a4j:commandButton action="#{faturaController.openXeroIntegrationSettingsModalOrIntegrateAll}"
                                               value="#{bundle['_nls.button.integrar']}" styleClass="buttonGeneric"
                                               rendered="#{faturaController.bean.financialMode}"
                                               disabled="#{faturaController.bean.isIntegrateButtonDisabled}" />
                        </sec:ifAnyGranted>
                    </h:panelGrid>
                </f:facet>
            </h:panelGrid>


            <rich:spacer height="5" styleClass="noMargin" />


            <a4j:outputPanel id="faturaPanel">
                <a4j:outputPanel id="faturaTable"
                                 rendered="#{!empty faturaController.bean.resultList}">
                    <table border="1" class="dr-table rich-table" width="100%">
                        <thead class="dr-table-thead">
                        <tr class="dr-table-header rich-table-header">
                            <th class="dr-table-headercell rich-table-headercell"></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.codigo_fatura.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.cliente.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.msa.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.deal_fiscal.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.data_previsao.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.data_vencimento.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.valor_total_fatura.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.login_ae.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.indicador_status.label']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.pagamento.label']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.is_commissioned']}" /></th>
                            <th class="dr-table-headercell rich-table-headercell"><h:outputLabel
                                    value="#{bundle['_nls.fatura.action.label']}" /></th>
                        </tr>
                        </thead>
                        <thead class="dr-table-thead">
                        <tr class="dr-table-subheader rich-table-subheader">
                            <th class="dr-table-subheadercell rich-table-subheadercell"
                                colspan="2"><h:outputText rendered="#{!faturaController.bean.isAllPending}"
                                                          value="#{bundle['_nls.select.label']}"
                                                          styleClass="labelGeneric" /> <rich:spacer height="5"
                                                                                                    width="5" /> <a4j:commandLink rendered="#{!faturaController.bean.isAllPending}"
                                                                                                                                value="#{bundle['_nls.all.label']}" styleClass="linkGeneric"
                                                                                                                                action="#{faturaController.selectAllFatura}" /> <rich:spacer
                                    height="5" width="5" /> <h:outputText value="/" rendered="#{!faturaController.bean.isAllPending}"
                                                                          styleClass="labelGeneric" /> <rich:spacer height="5"
                                                                                                                    width="5" /> <a4j:commandLink rendered="#{!faturaController.bean.isAllPending}"
                                                                                                                                                value="#{bundle['_nls.none.label']}" styleClass="linkGeneric"
                                                                                                                                                action="#{faturaController.unselectAllFatura}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.item_fatura.tipo_servico.label']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.item_fatura.valor_item.label']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.item_fatura.fonte_receita.label']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.item_fatura.doc_number.label']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.item_fatura.pagamento.label']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"><h:outputLabel
                                    value="#{bundle['_nls.comissao.entity_name']}" /></th>
                            <th class="dr-table-subheadercell rich-table-subheadercell"></th>
                        </tr>
                        </thead>
                        <tbody>

                        <!-- ************* Linha totalizacao ************* -->
                        <a4j:region
                                rendered="#{faturaController.bean.showTotalGeralFatura}">
                            <tr class="dr-table-subheader rich-table-subheader totalLine">
                                <td class="dr-table-subheadercell rich-table-subheadercell"
                                    colspan="2"><h:outputLabel
                                        value="#{bundle['_nls.total.label']}"
                                        styleClass="labelGeneric" /></td>
                                <td class="dr-table-subheadercell rich-table-subheadercell"
                                    colspan="5"></td>
                                <th class="dr-table-subheadercell rich-table-subheadercell"
                                    align="right"><h:outputLabel
                                        value="#{faturaController.bean.patternCurrency}" /> <h:outputText
                                        value="#{faturaController.bean.totalGeralFatura}">
                                    <f:convertNumber locale="#{bundle['locale.en_us']}"
                                                     pattern="#{systemProperties['pattern.number']}" />
                                </h:outputText></th>
                                <th class="dr-table-subheadercell rich-table-subheadercell"
                                    colspan="5"></th>
                            </tr>
                        </a4j:region>

                        <!-- ************* Linha resultados ************* -->
                        <a4j:repeat value="#{faturaController.bean.resultList}"
                                    var="item" rowKeyVar="row">
                            <tr>

                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:selectBooleanCheckbox value="#{item.isSelected}" valueChangeListener="#{faturaController.onFaturaRowSelectionChange}"
                                                             disabled="#{item.fatura.indicadorStatus != 'AP'}">
                                        <a4j:support event="onchange" reRender="faturaPanel,faturaTable" ajaxSingle="true"/>
                                        <f:attribute name="faturaRow" value="#{item}"/>
                                    </h:selectBooleanCheckbox>
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <a4j:commandLink action="#{faturaController.prepareViewFinancialModal}"
                                                     reRender="viewFaturaPanel" limitToList="true"
                                                     oncomplete="#{rich:component('viewFaturaPanel')}.show(); return false;">

                                        <h:outputText value="#{item.fatura.codigoFatura}" />

                                        <f:setPropertyActionListener
                                                value="#{item.fatura.codigoFatura}"
                                                target="#{faturaController.bean.currentRowId}" />
                                    </a4j:commandLink>
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell"><a4j:commandLink
                                        rendered="#{!item.showItemFatura}" reRender="faturaTable"
                                        limitToList="true" ajaxSingle="true"
                                        action="#{faturaController.showHideItemFatura}">
                                    <h:graphicImage value="/images/icons/plus.gif"
                                                    style="border:0" />
                                    <f:setPropertyActionListener value="#{item}"
                                                                 target="#{faturaController.bean.faturaRow}" />
                                </a4j:commandLink> <a4j:commandLink rendered="#{item.showItemFatura}"
                                                                    ajaxSingle="true"
                                                                    action="#{faturaController.showHideItemFatura}"
                                                                    reRender="faturaTable" limitToList="true">
                                    <h:graphicImage value="/images/icons/minus.gif"
                                                    style="border:0" />
                                    <f:setPropertyActionListener value="#{item}"
                                                                 target="#{faturaController.bean.faturaRow}" />
                                </a4j:commandLink> <rich:spacer width="4" /> <h:outputText
                                        value="#{item.fatura.dealFiscal.msa.cliente.nomeCliente}" />
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText value="#{item.fatura.dealFiscal.msa.nomeMsa}" />
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell"><h:outputText
                                        value="#{item.fatura.dealFiscal.nomeDealFiscal}" /></td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText value="#{item.fatura.dataPrevisao}">
                                        <f:convertDateTime
                                                pattern="#{bundle['_nls.calendar.pattern']}" />
                                    </h:outputText>
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText value="#{item.fatura.dataVencimento}">
                                        <f:convertDateTime
                                                pattern="#{bundle['_nls.calendar.pattern']}" />
                                    </h:outputText>
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="right">
                                    <h:outputLabel value="#{item.patternCurrency}" /> <h:outputText
                                        value="#{item.totalFatura}">
                                    <f:convertNumber locale="#{bundle['locale.en_us']}"
                                                     pattern="#{systemProperties['pattern.number']}" />
                                </h:outputText>
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText value="#{item.fatura.codigoLoginAe}" />
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText id="teste"
                                                  value="#{item.fatura.indicadorStatus}"
                                                  converter="StatusFaturaConverter" /> <rich:toolTip
                                        for="teste" rendered="#{item.fatura.textoError != null}"
                                        value="#{item.fatura.textoError}" />
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText value="#{item.statusPagamento}" />
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <h:outputText value="#{bundle['_nls.yes.label']}"
                                                  rendered="#{item.isCommission}" /> <h:outputText
                                        value="#{bundle['_nls.no.label']}"
                                        rendered="#{not item.isCommission}" />
                                </td>
                                <td class="dr-subtable-cell rich-subtable-cell" align="center">
                                    <sec:ifAnyGranted roles="BOF.INVOICING:VW">
                                        <a4j:commandLink ajaxSingle="false" id="viewlink"
                                                         action="#{faturaController.prepareViewFinancial}">
                                            <h:graphicImage value="/images/icons/view.png"
                                                            style="border:0" />
                                            <f:setPropertyActionListener value="#{item}"
                                                                         target="#{faturaController.bean.faturaRow}" />
                                            <f:setPropertyActionListener
                                                    value="#{item.fatura.codigoFatura}"
                                                    target="#{faturaController.bean.currentRowId}" />
                                        </a4j:commandLink>
                                        <rich:toolTip for="viewlink" value="#{bundle['_nls.hint.view']}" />
                                    </sec:ifAnyGranted>

                                    <sec:ifAnyGranted roles="BOF.INVOICING:ED">
                                        <h:panelGroup rendered="#{item.fatura.indicadorStatus == 'OP'
					                							or item.fatura.indicadorStatus == 'AP'
					                							or item.fatura.indicadorStatus == 'FC'}">
                                            <h:panelGroup rendered="#{!faturaController.bean.financialMode
																	and !faturaController.bean.searchDeletedInvoice}">
                                                <a4j:commandLink ajaxSingle="false" id="editlink"
                                                                 action="#{faturaController.prepareManage}">
                                                    <h:graphicImage value="/images/icons/edit.gif" style="border:0" />
                                                    <f:setPropertyActionListener value="#{item}"
                                                                                 target="#{faturaController.bean.faturaRow}" />
                                                    <f:setPropertyActionListener value="#{item.fatura.codigoFatura}"
                                                                                 target="#{faturaController.bean.currentRowId}" />
                                                </a4j:commandLink>
                                            </h:panelGroup>
                                            <rich:toolTip for="editlink" value="#{bundle['_nls.hint.edit']}" />
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{item.fatura.indicadorStatus != 'CA'}">
                                            <h:panelGroup rendered="#{faturaController.bean.financialMode
																	and !faturaController.bean.searchDeletedInvoice}">
                                                <a4j:commandLink ajaxSingle="false" id="editLinkFinancial"
                                                                 action="#{faturaController.prepareManageFinancial}">
                                                    <h:graphicImage value="/images/icons/edit.gif" style="border:0" />
                                                    <f:setPropertyActionListener value="#{item.fatura}"
                                                                                 target="#{faturaController.bean.to}" />
                                                </a4j:commandLink>
                                            </h:panelGroup>
                                            <rich:toolTip for="editLinkFinancial" value="#{bundle['_nls.hint.edit']}" />
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{item.fatura.indicadorStatus == 'SB'}">
                                            <h:panelGroup rendered="#{!faturaController.bean.financialMode
																	and !faturaController.bean.searchDeletedInvoice}">
                                                <a4j:commandLink ajaxSingle="false" id="editlinkAdmin"
                                                                 action="#{faturaController.prepareManage}">
                                                    <h:graphicImage value="/images/icons/edit.gif"
                                                                    style="border:0" />
                                                    <f:setPropertyActionListener value="#{item}"
                                                                                 target="#{faturaController.bean.faturaRow}" />
                                                    <f:setPropertyActionListener value="#{item.fatura.codigoFatura}"
                                                                                 target="#{faturaController.bean.currentRowId}" />
                                                </a4j:commandLink>
                                            </h:panelGroup>
                                            <rich:toolTip for="editlinkAdmin" value="#{bundle['_nls.hint.edit']}" />
                                        </h:panelGroup>
                                    </sec:ifAnyGranted>
                                </td>
                            </tr>
                            <!-- ************* ItemFatura da Fatura corrente ************* -->
                            <a4j:region rendered="#{item.showItemFatura}">
                                <a4j:repeat value="#{item.fatura.itemFaturas}" var="itemFatura">
                                    <tr class="footerLine">
                                        <td class="dr-subtable-cell rich-subtable-cell" colspan="5"></td>
                                        <td class="dr-subtable-cell rich-subtable-cell"><h:outputText
                                                value="#{itemFatura.tipoServico.nomeTipoServico}" /></td>
                                        <td class="dr-subtable-cell rich-subtable-cell"></td>
                                        <td class="dr-subtable-cell rich-subtable-cell" align="right">
                                            <h:outputLabel value="#{item.patternCurrency}" /> <h:outputText
                                                value="#{itemFatura.valorItem}">
                                            <f:convertNumber locale="#{bundle['locale.en_us']}"
                                                             pattern="#{systemProperties['pattern.number']}" />
                                        </h:outputText>
                                        </td>
                                        <td class="dr-subtable-cell rich-subtable-cell"
                                            align="center"><h:outputText
                                                value="#{itemFatura.fonteReceita.nomeFonteReceita}"
                                                converter="NullValueConverter" /></td>
                                        <td class="dr-subtable-cell rich-subtable-cell"
                                            align="center"><h:outputText
                                                value="#{itemFatura.numeroNotaFiscal}"
                                                converter="NullValueConverter" /></td>
                                        <td class="dr-subtable-cell rich-subtable-cell">
                                            <h:outputText
                                                    value="#{itemFatura.statusItem}"
                                                    rendered="#{itemFatura.dataPagamento == null}" />
                                            <h:outputText
                                                    value="#{itemFatura.dataPagamento}"
                                                    rendered="#{itemFatura.dataPagamento != null}">
                                                <f:convertDateTime
                                                        pattern="#{bundle['_nls.calendar.pattern']}" />
                                            </h:outputText></td>
                                        <td class="dr-subtable-cell rich-subtable-cell"
                                            align="center"><h:outputText
                                                converter="StatusComissaoConverter"
                                                value="#{itemFatura.statusComissao}" /></td>
                                        <td class="dr-subtable-cell rich-subtable-cell"></td>
                                    </tr>
                                </a4j:repeat>
                            </a4j:region>
                        </a4j:repeat>

                        <!-- ************* Rodape, botoes, campos ************* -->
                        <tr class="footerLine">
                            <td class="dr-subtable-cell rich-subtable-cell" colspan="13">
                                <h:panelGroup
                                        rendered="#{!faturaController.bean.financialMode}">
                                    <sec:ifAnyGranted roles="BOF.INVOICING:CR">
                                        <a4j:commandLink id="addlink"
                                                         action="#{faturaController.prepareCreate}">
                                            <h:graphicImage value="/images/icons/add.gif" height="16"
                                                            width="16" style="border:0" />
                                        </a4j:commandLink>
                                        <rich:toolTip for="addlink"
                                                      value="#{bundle['_nls.hint.add']}" />

                                        <rich:spacer height="5" width="5" />
                                    </sec:ifAnyGranted>

                                    <sec:ifAnyGranted roles="BOF.INVOICING:DE">
                                        <a4j:commandLink id="deleteAlllink" limitToList="true"
                                                         oncomplete="#{rich:component('deleteAllFaturaPanel')}.show()">
                                            <h:graphicImage value="/images/icons/delete.gif" height="16"
                                                            width="16" style="border:0" />
                                        </a4j:commandLink>
                                        <rich:toolTip for="deleteAlllink"
                                                      value="#{bundle['_nls.hint.remove.all']}" />

                                        <rich:spacer height="5" width="5" />
                                    </sec:ifAnyGranted>

                                    <sec:ifAnyGranted roles="BOF.INVOICING:ED">
                                        <a4j:commandLink id="approveAlllink" limitToList="true"
                                                         action="#{faturaController.approveAllFatura}"
                                                         reRender="faturaTable, errorMsgId">
                                            <h:graphicImage value="/images/icons/passed.gif" height="16"
                                                            width="16" style="border:0" />
                                        </a4j:commandLink>
                                        <rich:toolTip for="approveAlllink"
                                                      value="#{bundle['_nls.hint.approve.all']}" />

                                        <rich:spacer height="5" width="5" />
                                    </sec:ifAnyGranted>

                                    <sec:ifAnyGranted roles="BOF.INVOICING:CR">
                                        <a4j:commandLink id="copyLink" limitToList="true"
                                                         oncomplete="#{rich:component('copyModal')}.show()">
                                            <h:graphicImage value="/images/icons/copy.gif" height="16"
                                                            width="16" style="border:0" />
                                        </a4j:commandLink>
                                        <rich:toolTip for="copyLink"
                                                      value="#{bundle['_nls.hint.copy.all']}" />
                                    </sec:ifAnyGranted>
                                </h:panelGroup>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </a4j:outputPanel>
            </a4j:outputPanel>

        </h:form>

        <ui:include src="/pages/protected/fatura/FaturaViewModal.xhtml" />

        <!-- Modal do Copy  -->
        <rich:modalPanel id="copyModal" autosized="true">
            <f:facet name="header">
                <h:outputText value="#{bundle['_nls.fatura.copy.title.label']}"
                              style="padding-right:15px;" />
            </f:facet>
            <f:facet name="controls">
                <h:panelGroup>
                    <h:graphicImage value="/images/icons/close.gif"
                                    styleClass="hidelink" id="closeCopyModalId" />
                    <rich:componentControl for="copyModal" attachTo="closeCopyModalId"
                                           operation="hide" event="onclick" />
                </h:panelGroup>
            </f:facet>
            <h:form>
                <table width="220">
                    <tbody>
                    <tr>
                        <td align="center" width="50%">
                            <h:outputText value="#{bundle['_nls.fatura.copy.qtd.label']}:" />
                            <rich:spacer height="5" width="5" />
                            <h:inputText validator="#{xssValidator.validate}" required="true"
                                         id="qtdCopy" size="6" maxlength="8"
                                         label="#{bundle['_nls.fatura.copy.qtd.label']}"
                                         value="#{faturaController.bean.numberOfCopies}">
                                <f:validateDoubleRange minimum="1" />
                                <rich:jQuery
                                        query="numeric('#{bundle['locale.decimal.separator']}')"
                                        timing="onload" selector="#qtdCopy" />
                            </h:inputText>
                            <rich:spacer height="5" width="5" style="noMargin" />
                            <a4j:commandButton
                                value="#{bundle['_nls.button.ok']}"
                                action="#{faturaController.copyAllSelected}"
                                oncomplete="#{rich:component('copyModal')}.hide();"
                                reRender="copyModal,faturaTable,errorMsgId" limitToList="true" />
                        </td>
                    </tr>
                    </tbody>
                </table>
            </h:form>
        </rich:modalPanel>


        <rich:modalPanel id="deleteAllFaturaPanel" autosized="true"
                         width="200">
            <f:facet name="header">
                <h:outputText value="#{bundle['_nls.title.delete_all']}"
                              style="padding-right:15px;" />
            </f:facet>
            <f:facet name="controls">
                <h:panelGroup>
                    <h:graphicImage value="/images/icons/close.gif"
                                    styleClass="hidelink" id="hidelinkDeleteAllFatura" />
                    <rich:componentControl for="deleteAllFaturaPanel"
                                           attachTo="hidelinkDeleteAllFatura" operation="hide"
                                           event="onclick" />
                </h:panelGroup>
            </f:facet>
            <h:form>
                <table width="100%">
                    <tbody>
                    <tr>
                        <td align="center" width="50%"><a4j:commandButton
                                value="#{bundle['_nls.button.ok']}" ajaxSingle="false"
                                action="#{faturaController.removeAllFatura}"
                                oncomplete="#{rich:component('deleteAllFaturaPanel')}.hide();"
                                reRender="deleteAllFaturaPanel, faturaTable, faturaPanel, errorMsgId"
                                limitToList="true" styleClass="buttonGeneric" /></td>
                        <td align="center" width="50%"><a4j:commandButton
                                limitToList="true" value="#{bundle['_nls.button.cancel']}"
                                styleClass="buttonGeneric"
                                oncomplete="#{rich:component('deleteAllFaturaPanel')}.hide();return false;" />
                        </td>
                    </tr>
                    </tbody>
                </table>
            </h:form>
        </rich:modalPanel>

        <rich:modalPanel id="xeroIntegrationSettingsModal" width="320" autosized="true"
                         showWhenRendered="#{faturaController.bean.showXeroLineIntegrationModal}">
            <f:facet name="header">
                <h:outputText value="#{bundle['_nls.fatura.xero_integration_settings.modal.title']}"
                              style="padding-right:15px;"/>
            </f:facet>
            <h:form>
                <h:outputText value="#{bundle['_nls.fatura.xero_integration_settings.modal.body']}"/>
                <h:selectOneRadio label="Xero Line Integration Option" required="true" layout="pageDirection" style="margin-top:15px"
                                  value="#{faturaController.bean.xeroLineIntegration}" immediate="true">
                    <f:selectItem id="idDetailed" itemValue="DETAILED" itemEscaped="false"
                                  itemLabel="#{bundle['_nls.fatura.xero_integration_settings.modal.detailed']}&lt;/br&gt;
&lt;p style=&quot;color:gray;margin:0px;margin-left:25px;margin-top:3px&quot;&gt;#{bundle['_nls.fatura.xero_integration_settings.modal.detailed.description']}&lt;/p&gt;"/>
                    <f:selectItem id="idSummarized" itemValue="SUMMARIZED" itemEscaped="false"
                                  itemLabel="#{bundle['_nls.fatura.xero_integration_settings.modal.summarized']}&lt;/br&gt;
&lt;p style=&quot;color:gray;margin:0px;margin-left:25px;margin-top:3px&quot;&gt;#{bundle['_nls.fatura.xero_integration_settings.modal.summarized.description']}&lt;/p&gt;"/>
                </h:selectOneRadio>

                <rich:spacer height="25"/>

                <h:panelGrid columns="3" style="display:flex; justify-content:center">
                    <a4j:commandButton
                            value="#{bundle['_nls.button.cancel']}"
                            action="#{faturaController.closeXeroLineIntegrationModal}"
                            oncomplete="#{rich:component('xeroIntegrationSettingsModal')}.hide();"
                            reRender="xeroIntegrationSettingsModal,faturaTable,errorMsgId"/>

                    <rich:spacer width="20"/>

                    <a4j:commandButton
                            value="#{bundle['_nls.button.integrar']}"
                            action="#{faturaController.integrateAll}"
                            oncomplete="#{rich:component('xeroIntegrationSettingsModal')}.hide();"
                            reRender="xeroIntegrationSettingsModal,faturaTable,errorMsgId"/>
                </h:panelGrid>
            </h:form>
        </rich:modalPanel>

    </ui:define>

</ui:composition>

</html>